generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      Role     @default(EDUCATEE)

  profile   Profile?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  favorites             Favorite[]
  reviews               Review[]
  enrollments           Enrollment[]
  workshopRegistrations WorkshopRegistration[]
  workshopSubmissions   WorkshopSubmission[]
  moduleProgresses      ModuleProgress[]
  jobPostings           JobPosting[]
  jobApplications       JobApplication[]
  skills                Skill[]
  experiences           Experience[]
  cvs                   CV[]
  adminActions          AdminAction[]
}

model Profile {
  id             String   @id @default(uuid())
  name           String?
  dob            DateTime?
  gender         Gender?
  pictureUrl     String?
  bio            String?
  companyName    String?
  companyWebsite String?

  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])

  verification   CorporationVerification?
}

model CorporationVerification {
  id         String            @id @default(uuid())
  status     CorporationStatus @default(UNVERIFIED)
  verifiedAt DateTime?

  profileId  String   @unique
  profile    Profile @relation(fields: [profileId], references: [id])
}

model Category {
  id        String   @id @default(uuid())
  name      String   @unique
  slug      String   @unique
  courses   Course[]
  createdAt DateTime @default(now())
}

model Course {
  id           String      @id @default(uuid())
  title        String
  slug         String      @unique
  description  String
  level        CourseLevel
  duration     Int
  thumbnailUrl String      @default("/thumbnail.jpeg")
  isPublished  Boolean     @default(false)

  avgRating    Float       @default(0)
  reviewCount  Int         @default(0)

  categoryId   String
  category     Category   @relation(fields: [categoryId], references: [id])

  items              CourseItem[]
  modules            Module[]
  workshops          Workshop[]
  learningPathItems  LearningPathItem[]
  enrollments        Enrollment[]
  favorites          Favorite[]
  reviews            Review[]

  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}

model Favorite {
  userId   String
  courseId String
  createdAt DateTime @default(now())

  user   User   @relation(fields: [userId], references: [id])
  course Course @relation(fields: [courseId], references: [id])

  @@id([userId, courseId])
}

model Review {
  id        String   @id @default(uuid())
  rating    Int
  comment   String?
  createdAt DateTime @default(now())

  userId   String
  courseId String

  user     User   @relation(fields: [userId], references: [id])
  course   Course @relation(fields: [courseId], references: [id])

  @@unique([userId, courseId]) // one review per user per course
}

model CourseItem {
  id          String @id @default(uuid())
  position    Int
  type        CourseItemType

  courseId    String
  course      Course @relation(fields: [courseId], references: [id])

  moduleId    String?
  workshopId  String?

  module      Module?   @relation(fields: [moduleId], references: [id])
  workshop    Workshop? @relation(fields: [workshopId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([courseId, position])
}

model Module {
  id         String @id @default(uuid())
  title      String
  contentUrl String

  courseId   String
  course     Course @relation(fields: [courseId], references: [id])

  courseItems CourseItem[]
  progresses  ModuleProgress[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model ModuleProgress {
  userId      String
  moduleId    String
  completedAt DateTime?

  user   User   @relation(fields: [userId], references: [id])
  module Module @relation(fields: [moduleId], references: [id])

  @@unique([userId, moduleId])
}

model Workshop {
  id           String @id @default(uuid())
  title        String
  instructions String

  courseId     String
  course       Course @relation(fields: [courseId], references: [id])

  courseItems  CourseItem[]

  registrations WorkshopRegistration[]
  submissions   WorkshopSubmission[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model WorkshopRegistration {
  id           String   @id @default(uuid())
  registeredAt DateTime @default(now())

  userId       String
  workshopId   String

  user         User     @relation(fields: [userId], references: [id])
  workshop     Workshop @relation(fields: [workshopId], references: [id])

  @@unique([userId, workshopId])
}

model WorkshopSubmission {
  id            String   @id @default(uuid())
  submissionUrl String
  score         Int?
  feedback      String?
  submittedAt   DateTime @default(now())

  userId        String
  workshopId    String

  user          User     @relation(fields: [userId], references: [id])
  workshop      Workshop @relation(fields: [workshopId], references: [id])

  @@unique([userId, workshopId])
}

model Enrollment {
  id              String @id @default(uuid())
  progressPercent Float  @default(0)
  status          EnrollmentStatus @default(IN_PROGRESS)

  userId          String
  courseId        String

  user            User   @relation(fields: [userId], references: [id])
  course          Course @relation(fields: [courseId], references: [id])

  certificate     Certificate?

  @@unique([userId, courseId])
}

model Certificate {
  id              String   @id @default(uuid())
  certificateCode String   @unique
  issuedAt        DateTime @default(now())

  enrollmentId    String   @unique
  enrollment      Enrollment @relation(fields: [enrollmentId], references: [id])
}

model LearningPath {
  id           String     @id @default(uuid())
  title        String     @unique
  slug         String     @unique
  description  String
  thumbnailUrl String     @default("/thumbnail.jpeg")
  isPublished  Boolean    @default(false)

  items       LearningPathItem[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model LearningPathItem {
  id             String @id @default(uuid())
  position       Int

  learningPathId String
  courseId       String

  learningPath   LearningPath @relation(fields: [learningPathId], references: [id])
  course         Course       @relation(fields: [courseId], references: [id])

  @@unique([learningPathId, position])
}

model JobPosting {
  id        String    @id @default(uuid())
  title     String
  status    JobStatus @default(DRAFT)

  userId    String
  user      User      @relation(fields: [userId], references: [id])

  applications JobApplication[]

  createdAt DateTime @default(now())
}

model JobApplication {
  id        String    @id @default(uuid())
  status    ApplicationStatus @default(APPLIED)
  appliedAt DateTime @default(now())

  userId    String
  jobId     String

  user      User       @relation(fields: [userId], references: [id])
  job       JobPosting @relation(fields: [jobId], references: [id])
}

model Skill {
  id     String @id @default(uuid())
  name   String

  userId String
  user   User   @relation(fields: [userId], references: [id])

  @@unique([userId, name])
}

model Experience {
  id          String   @id @default(uuid())
  jobTitle    String
  companyName String
  startDate   DateTime
  endDate     DateTime?

  userId      String
  user        User     @relation(fields: [userId], references: [id])
}

model CV {
  id          String   @id @default(uuid())
  template    String
  generatedAt DateTime @default(now())

  userId      String
  user        User     @relation(fields: [userId], references: [id])
}

model AdminAction {
  id         String   @id @default(uuid())
  actionType AdminActionType
  createdAt  DateTime @default(now())

  userId     String
  user       User     @relation(fields: [userId], references: [id])
}

enum Role {
  ADMIN
  CORPORATION
  EDUCATEE
}

enum Gender {
  MALE
  FEMALE
}

enum CorporationStatus {
  UNVERIFIED
  PENDING
  VERIFIED
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum CourseItemType {
  MODULE
  WORKSHOP
}

enum EnrollmentStatus {
  IN_PROGRESS
  COMPLETED
}

enum JobStatus {
  DRAFT
  PUBLISHED
  CLOSED
}

enum ApplicationStatus {
  APPLIED
  REVIEWED
  ACCEPTED
  REJECTED
}

enum AdminActionType {
  APPROVE_COURSE
  VERIFY_CORPORATION
}